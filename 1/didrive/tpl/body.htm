{% spaceless %}

    
    {% set sp = readItems( 'sale_point', null )  %}
    {# { pa(sp.data)|raw } #}

    {% set job_in = readItems( '050.job_in_sp', null )  %}
    {# { pa(sp.data)|raw } #}

    {% set man = readItems( '070.jobman', null )  %}
    man
    <div style="max-height: 250px; border: 1px solid green; padding:10px; margin: 10px; overflow: auto;" >
    {{ pa(man) }}
    </div>

    {% set dolgn = readItems( '061.dolgnost', null )  %}
    {# { pa(sp.data)|raw } #}

    <div class="container-fluid">

        {% if 1 == 2 %}
            <div class="row">
                <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 col-xl-12">

                    {# % extends "body.htm" % #}
                    {# % block block1 %} block 11111111111111111 {% endblock % #}

                    {# % set krohi['1']['text'] = 'Интерфейс работы Супер администратора' %}
                    {% set krohi['1']['uri'] = get.level % #}

                    <h3>Порядок работы по шагам v0.1 <sup><a href="#" onclick="$('#list1').toggle('slow');
                            return false;" >развернуть/свернуть</a></sup> </h3>

                    {# { pa(list_plan)|raw } #}

                    <ol style="line-height:3em;display:none;" id="list1" >

                        {% for k, v in list_plan %} 

                            <li><a href="{{ v.link }}" class="btn btn-xs btn-info">{{ v.head}}</a> - {{ v.opis }}</li>

                        {% endfor %}

                        {#
                        <li><a href="#" class="btn btn-xs btn-info">Точки продаж</a> - добавляем точки продаж</li>
                        <li><a href="#" class="btn btn-xs btn-info">Должности</a> - возможные должности</li>
                        <li><a href="#" class="btn btn-xs btn-info">Размер оплаты труда</a> - добавляем настройки размеров оплаты труда должностям работающим на точке (точка "default" содержит настройки для всех точек у которых не назначены свои цифры)</li>
                        <li><a href="#" class="btn btn-xs btn-info">Сотрудники</a> - добавляем ФИО и назначем должность и даты старта стажировки/работы/уволнения сотрудника</li>
                        <li><a href="#" class="btn btn-xs btn-info">Назначение работника на точку продаж</a> - определяем кто и когда работает ( работник + точка продаж + дата )</li>
                        <li><a href="#" class="btn btn-xs btn-info">Реестр check-in check-out</a> - определяем кто и когда начал работу/закочил работу (работник + дата,время старта/финиша) </li>
                        <li><a href="#" class="btn btn-xs btn-info">Взыскания</a> - если есть взыскания персоналу, добавляем (участнвует дальше в расчёте оплаты)</li>
                        <li><a href="#" class="btn btn-xs btn-info">ЗП работников</a> - реестр кому сколько платим</li>
                        #}

                    </ol>

                </div>
            </div>
        {% endif %}

        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 col-xl-12 text-center">
                <Br/>
                <Br/>
                <h3>Учёт рабочего времени, выставление оценок</h3>
                <br/>
                <br/>
            </div>
        </div>

        <div class="row" style="background-color:rgba(0,0,0,0.05);padding: 15px 0; ">
            <div class="col-xs-12 col-sm-6 col-md-6 col-lg-6 col-xl-6 text-center">

                {% if get.date is defined %}

                    {% set date_start = get.date|date("Y-m-d") %}
                    {% set date_finish = date_start|date_modify("+30 day")|date("Y-m-d") %}

                {% else %}

                    {% set date_start = now|date_modify("-3 day")|date("Y-m-d") %}
                    {% set date_finish = date_start|date_modify("+30 day")|date("Y-m-d") %}

                {% endif %}


                {% if 1 == 1 %}
                    Указать дату начала просмотра даных
                    <form action="" method=get" >
                        <input type="date" name="date" >

                        {# { get.level } #}

                        {% if get.level is defined %}
                            <input type="hidden" name="level" value="{{ get.level }}" >
                        {% else %}
                            <input type="hidden" name="level" value="000.index" >
                        {% endif %}

                        <input type="submit" value="Показать" >
                    </form>
                    <Br/>
                {% endif %}


                <p><b> Показ данных с {{ date_start|date("d.m.Y") }} по {{ date_finish|date("d.m.Y") }} </b></p>


            </div>
            <div class="col-xs-12 col-sm-6 col-md-6 col-lg-6 col-xl-6">

                <p><a href="#" onclick="$('#leg').toggle('slow'); return false;">Легенда <sup>показать/скрыть</sup></a></p>
                <span id='leg' style="display:none;" >
                    <br/>
                    <b>+Сотрудники:</b>
                    <Br/>
                    <span class="job_man_in_graph stag" style="display:inline-block;margin: 2px 5px;">Стажировка</span>
                    <span class="job_man_in_graph norm" style="display:inline-block;margin: 2px 5px;" >Норм работа</span>
                    <span class="job_man_in_graph spec" style="display:inline-block;margin: 2px 5px;" >Спец назначение</span>
                    <span class="job_man_in_graph job_other" style="display:inline-block;margin: 2px 5px;" >Работает на другой точке</span>
                    <Br/>
                    <Br/>
                    <b>+Записи к смене сотрудника:</b>
                    <Br/>
                    <span class='list_otrezki' >
                        <div class="smena_started" style="display:inline-block;margin: 2px 5px;">Смена начата сотрудником и ещё не отмечена как законченая</div>
                        <div class="smena_started_error" style="display:inline-block;margin: 2px 5px;">Смена начата сотрудником и отмечена как ошибка</div>
                        <div class="smena_started_ok" style="display:inline-block;margin: 2px 5px;">Смена начата сотрудником и отмечена как законченная</div>
                        <div class="smena_ok" style="display:inline-block;margin: 2px 5px;">Смена добавлена</div>
                        <div class="smena_cancel" style="display:inline-block;margin: 2px 5px;">Смена отменена</div>
                        <div class="pay_check" style="display:inline-block;margin: 2px 5px;">Смена отработана, отправлена на оплату</div>
                        <div class="buh_ok" style="display:inline-block;margin: 2px 5px;">Смена отработана, оплата выдана</div>
                        <div class="minus" style="display:inline-block;margin: 2px 5px;">Взыскание</div>
                    </span>
                </span>

            </div>
        </div>

        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 col-xl-12">

                {# заготовка модальных окошек #}
                {% include dir_mod_now_mod_ditpl~'body.modal_wind.htm' %}

                {% set jobs = get_smena_jobs( date_start, date_finish ) %}
                jobs
                {{ pa( jobs ) }}

                {% set checki = get_checki( date_start, date_finish ) %}
                {# { pa(checki) } #}

                {% set minusa = get_minusa( db, date_start, date_finish ) %}
                {# { pa(minusa) } #}

                <Br/>
                <Br/>

                <ul class="list_sp">

                    {# перебор точек продаж #}
                    {% for spoint_id, spoint in sp.data if spoint.head != 'default' and spoint.status == 'show' %} 

                        <li style="list-style: none;">

                            <h4 style="padding: 2px; background-color: rgba(0,0,0,0.1);">
                                {{ spoint.head }} <span style="float:right; color:rgba(0,0,0,0.3); font-size:10px;" >id:{{ spoint.id }}</span>
                            </h4> {# <a href="{{ v.link }}" class="btn btn-xs btn-info">{{ v.head}}</a> - {{ v.opis }} #}

                            {# $re[$sp['id']]['def_man'] #}
                            {% include dir_mod_now_mod_ditpl~'body.stistic.point.adm.htm' %}

                            {% set r = random() %}

                            {#                        
                            <a class="btn btn-info btn-xs" href="#" onclick="$('#a1s{{ r }}').toggle('slow');
                                    return false;" >График работы (скрыть/показать)</a>
                            #}

                            <table class="table table-bordered table_list_sp_job" id="a1s{{ r }}" >
                                <thead>
                                    <tr>
                                        {% for i in range(low=0, high=7, step=1) %}  
                                            <th

                                                {% if date_start|date_modify("+"~i~" day")|date("N") > 5 %}
                                                    style="background-color:rgba(255,0,0,0.1);"
                                                {% endif%}

                                                >

                                                {# % set nowd = "01-06-2019"|date_modify("+"~i~" day")|date("d.m.y") % #}
                                                {{ date_start|date_modify("+"~i~" day")|date("d.m") }}

                                                <a href="#" class='ocenka_dnya' onclick="$('#ocneka_{{ spoint_id }}_{{ loop.index }}').toggle();
                                                        return false;">
                                                    +оценка
                                                </a>

                                    <center>
                                        <div id="ocneka_{{ spoint_id }}_{{ loop.index }}" class="hide btn-group" role="group" aria-label="Basic example">
                                            <button class="btn btn-xs btn-light">3</button>
                                            <button class="btn btn-xs btn-warning">4</button>
                                            <button class="btn btn-xs btn-success">5</button>
                                        </div>
                                    </center>

                                    </th>
                                {% endfor %}
                                </tr>
                                </thead>                        
                                <tbody>
                                    <tr>

                                        {% for i in range(low=0, high=7, step=1) %}  
                                            <td class="list_stat_job_sp">

                                                {% set now_date = date_start|date_modify("+"~i~" day")|date("Y-m-d") %}

                                                {{ pa(now_date) }}
                                                
                                                {% include dir_mod_now_mod_ditpl~'body.mans.htm' %}

                                            </td>
                                        {% endfor %}

                                    </tr>
                                </tbody>
                            </table>

                        </li>

                    {% endfor %}
                </ul>
            </div>
        </div>
    </div>

{% endspaceless %}